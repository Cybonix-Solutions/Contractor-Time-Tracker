<!DOCTYPE html>
<!--
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                     CONTRACTOR TIME TRACKER v1.0.0                        ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë                                                                           ‚ïë
‚ïë  A professional time tracking and invoicing application for contractors  ‚ïë
‚ïë  and freelancers. Track time, manage breaks, edit sessions, and generate ‚ïë
‚ïë  professional invoices with beautiful formatting.                        ‚ïë
‚ïë                                                                           ‚ïë
‚ïë  FEATURES:                                                                ‚ïë
‚ïë  ‚Ä¢ Real-time time tracking with break management                         ‚ïë
‚ïë  ‚Ä¢ Manual entry for historical sessions                                  ‚ïë
‚ïë  ‚Ä¢ Edit functionality (within 14 days)                                   ‚ïë
‚ïë  ‚Ä¢ 7 beautiful themes with smooth transitions                            ‚ïë
‚ïë  ‚Ä¢ Professional Excel invoices with conditional formatting               ‚ïë
‚ïë  ‚Ä¢ CSV exports for accounting software                                   ‚ïë
‚ïë  ‚Ä¢ Customizable billing information                                      ‚ïë
‚ïë  ‚Ä¢ Complete privacy - all data stored locally                            ‚ïë
‚ïë  ‚Ä¢ No accounts, no cloud, no tracking                                    ‚ïë
‚ïë                                                                           ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë  DEVELOPER:    Joseph Mark Orimoloye                                     ‚ïë
‚ïë  COMPANY:      Cybonix Solutions LLC                                     ‚ïë
‚ïë  LICENSE:      MIT License                                               ‚ïë
‚ïë  VERSION:      1.0.0                                                     ‚ïë
‚ïë  RELEASE DATE: November 11, 2025                                         ‚ïë
‚ïë  REPOSITORY:   https://github.com/yourusername/contractor-time-tracker  ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë  Copyright (c) 2025 Joseph Mark Orimoloye | Cybonix Solutions LLC       ‚ïë
‚ïë                                                                           ‚ïë
‚ïë  Permission is hereby granted, free of charge, to any person obtaining   ‚ïë
‚ïë  a copy of this software and associated documentation files (the         ‚ïë
‚ïë  "Software"), to deal in the Software without restriction, including     ‚ïë
‚ïë  without limitation the rights to use, copy, modify, merge, publish,     ‚ïë
‚ïë  distribute, sublicense, and/or sell copies of the Software, and to      ‚ïë
‚ïë  permit persons to whom the Software is furnished to do so, subject to   ‚ïë
‚ïë  the following conditions:                                               ‚ïë
‚ïë                                                                           ‚ïë
‚ïë  The above copyright notice and this permission notice shall be          ‚ïë
‚ïë  included in all copies or substantial portions of the Software.         ‚ïë
‚ïë                                                                           ‚ïë
‚ïë  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,         ‚ïë
‚ïë  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF      ‚ïë
‚ïë  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  ‚ïë
‚ïë  IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY    ‚ïë
‚ïë  CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,    ‚ïë
‚ïë  TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE       ‚ïë
‚ïë  SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.                  ‚ïë
‚ïë                                                                           ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contractor Time Tracker</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--bg-gradient);
            min-height: 100vh;
            padding: 20px;
            transition: background 0.4s ease;
        }
        
        :root {
            --primary-start: #667eea;
            --primary-end: #764ba2;
            --button-primary: #28a745;
            --button-primary-hover: #218838;
            --button-warning: #ffc107;
            --button-warning-hover: #e0a800;
            --button-info: #17a2b8;
            --button-info-hover: #138496;
            --button-danger: #dc3545;
            --button-danger-hover: #c82333;
        }
        
        body {
            background: linear-gradient(135deg, var(--primary-start) 0%, var(--primary-end) 100%);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary-start) 0%, var(--primary-end) 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            transition: background 0.4s ease;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }
        
        .theme-selector {
            position: absolute;
            top: 30px;
            right: 30px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            max-width: 300px;
        }
        
        .theme-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .theme-circle:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .theme-circle.active {
            border-width: 4px;
            box-shadow: 0 0 0 2px rgba(255,255,255,0.5);
        }
        
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
            overflow-x: auto;
        }
        
        .tab {
            flex: 1;
            padding: 15px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            color: #6c757d;
            transition: all 0.3s;
            white-space: nowrap;
        }
        
        .tab:hover {
            background: #e9ecef;
        }
        
        .tab.active {
            color: var(--primary-start);
            background: white;
            border-bottom: 3px solid var(--primary-start);
            transition: color 0.4s ease, border-color 0.4s ease;
        }
        
        .content {
            padding: 30px;
            min-height: 500px;
        }
        
        .clock {
            text-align: center;
            font-size: 3em;
            font-weight: bold;
            color: var(--primary-start);
            margin: 20px 0;
            font-variant-numeric: tabular-nums;
            transition: color 0.4s ease;
        }
        
        .status {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-size: 1.2em;
            font-weight: 500;
        }
        
        .status.working {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }
        
        .status.offline {
            background: #fff3cd;
            color: #856404;
            border: 2px solid #ffeaa7;
        }
        
        .status.off {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        
        button {
            padding: 15px 30px;
            font-size: 16px;
            font-weight: 500;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-start {
            background: var(--button-primary);
            color: white;
            transition: background 0.3s ease;
        }
        
        .btn-start:hover:not(:disabled) {
            background: var(--button-primary-hover);
        }
        
        .btn-break {
            background: var(--button-warning);
            color: #000;
            transition: background 0.3s ease;
        }
        
        .btn-break:hover:not(:disabled) {
            background: var(--button-warning-hover);
        }
        
        .btn-return {
            background: var(--button-info);
            color: white;
            transition: background 0.3s ease;
        }
        
        .btn-return:hover:not(:disabled) {
            background: var(--button-info-hover);
        }
        
        .btn-end {
            background: var(--button-danger);
            color: white;
            transition: background 0.3s ease;
        }
        
        .btn-end:hover:not(:disabled) {
            background: var(--button-danger-hover);
        }
        
        .btn-export {
            background: var(--primary-start);
            color: white;
            transition: background 0.4s ease;
        }
        
        .btn-export:hover {
            background: var(--primary-end);
        }
        
        .btn-import {
            background: #6c757d;
            color: white;
        }
        
        .btn-import:hover {
            background: #5a6268;
        }

        .btn-add {
            background: var(--button-primary);
            color: white;
            transition: background 0.3s ease;
        }
        
        .btn-add:hover {
            background: var(--button-primary-hover);
        }

        .btn-edit {
            background: var(--button-info);
            color: white;
            transition: background 0.3s ease;
            padding: 8px 20px;
            font-size: 14px;
        }
        
        .btn-edit:hover:not(:disabled) {
            background: var(--button-info-hover);
        }

        .btn-edit:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        
        .input-group {
            margin: 15px 0;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #495057;
        }
        
        .input-group input, .input-group textarea, .input-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 16px;
            font-family: inherit;
        }
        
        .input-group textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .input-group input:focus, .input-group textarea:focus {
            outline: none;
            border-color: var(--primary-start);
            transition: border-color 0.4s ease;
        }
        
        .session-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            border-left: 4px solid var(--primary-start);
            transition: border-color 0.4s ease;
        }
        
        .session-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .session-date {
            font-weight: bold;
            color: var(--primary-start);
            font-size: 1.1em;
            transition: color 0.4s ease;
        }
        
        .session-hours {
            background: var(--primary-start);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 500;
            transition: background 0.4s ease;
        }
        
        .session-details {
            color: #6c757d;
            line-height: 1.6;
        }
        
        .session-details div {
            margin: 5px 0;
        }
        
        .break-item {
            background: white;
            padding: 10px;
            border-radius: 5px;
            margin: 5px 0;
            font-size: 0.9em;
        }
        
        .report-section {
            margin: 30px 0;
        }
        
        .report-section h3 {
            color: var(--primary-start);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #dee2e6;
            transition: color 0.4s ease;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: linear-gradient(135deg, var(--primary-start) 0%, var(--primary-end) 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            transition: background 0.4s ease;
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .stat-label {
            opacity: 0.9;
            font-size: 0.9em;
        }
        
        .hidden {
            display: none;
        }
        
        .settings-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .settings-section h3 {
            color: var(--primary-start);
            margin-bottom: 15px;
            transition: color 0.4s ease;
        }

        .manual-entry-form {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .manual-entry-form h3 {
            color: var(--primary-start);
            margin-bottom: 20px;
            transition: color 0.4s ease;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 2px solid #c3e6cb;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 2px solid #f5c6cb;
        }

        .warning-message {
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 2px solid #ffeaa7;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal {
            background: white;
            border-radius: 15px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-header {
            background: linear-gradient(135deg, var(--primary-start) 0%, var(--primary-end) 100%);
            color: white;
            padding: 20px 30px;
            border-radius: 15px 15px 0 0;
            transition: background 0.4s ease;
        }

        .modal-header h2 {
            margin: 0;
        }

        .modal-content {
            padding: 30px;
        }

        .modal-footer {
            padding: 20px 30px;
            border-top: 1px solid #dee2e6;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 14px;
        }

        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #555 transparent transparent transparent;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .clock {
                font-size: 2em;
            }
            
            .content {
                padding: 15px;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .theme-selector {
                position: static;
                justify-content: center;
                margin-top: 15px;
                max-width: 100%;
            }

            .header {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, memo } = React;

        // Theme definitions
        const THEMES = [
            {
                id: 'purple',
                name: 'Purple Majesty',
                primaryStart: '#667eea',
                primaryEnd: '#764ba2',
                buttonPrimary: '#28a745',
                buttonPrimaryHover: '#218838',
                buttonWarning: '#ffc107',
                buttonWarningHover: '#e0a800',
                buttonInfo: '#17a2b8',
                buttonInfoHover: '#138496',
                buttonDanger: '#dc3545',
                buttonDangerHover: '#c82333'
            },
            {
                id: 'ocean',
                name: 'Ocean Breeze',
                primaryStart: '#2E3192',
                primaryEnd: '#1BFFFF',
                buttonPrimary: '#00b894',
                buttonPrimaryHover: '#00a383',
                buttonWarning: '#fdcb6e',
                buttonWarningHover: '#f9b851',
                buttonInfo: '#0984e3',
                buttonInfoHover: '#0770c4',
                buttonDanger: '#d63031',
                buttonDangerHover: '#c21d1e'
            },
            {
                id: 'sunset',
                name: 'Sunset Blaze',
                primaryStart: '#FF512F',
                primaryEnd: '#DD2476',
                buttonPrimary: '#00b894',
                buttonPrimaryHover: '#00a383',
                buttonWarning: '#fdcb6e',
                buttonWarningHover: '#f9b851',
                buttonInfo: '#74b9ff',
                buttonInfoHover: '#5ca6f0',
                buttonDanger: '#d63031',
                buttonDangerHover: '#c21d1e'
            },
            {
                id: 'forest',
                name: 'Forest Green',
                primaryStart: '#134E5E',
                primaryEnd: '#71B280',
                buttonPrimary: '#00b894',
                buttonPrimaryHover: '#00a383',
                buttonWarning: '#fdcb6e',
                buttonWarningHover: '#f9b851',
                buttonInfo: '#0984e3',
                buttonInfoHover: '#0770c4',
                buttonDanger: '#d63031',
                buttonDangerHover: '#c21d1e'
            },
            {
                id: 'royal',
                name: 'Royal Gold',
                primaryStart: '#1e3c72',
                primaryEnd: '#f7971e',
                buttonPrimary: '#00b894',
                buttonPrimaryHover: '#00a383',
                buttonWarning: '#fdcb6e',
                buttonWarningHover: '#f9b851',
                buttonInfo: '#0984e3',
                buttonInfoHover: '#0770c4',
                buttonDanger: '#d63031',
                buttonDangerHover: '#c21d1e'
            },
            {
                id: 'berry',
                name: 'Berry Blast',
                primaryStart: '#8E2DE2',
                primaryEnd: '#4A00E0',
                buttonPrimary: '#00b894',
                buttonPrimaryHover: '#00a383',
                buttonWarning: '#fdcb6e',
                buttonWarningHover: '#f9b851',
                buttonInfo: '#a29bfe',
                buttonInfoHover: '#8b84f0',
                buttonDanger: '#d63031',
                buttonDangerHover: '#c21d1e'
            },
            {
                id: 'rose',
                name: 'Rose Garden',
                primaryStart: '#C04848',
                primaryEnd: '#480048',
                buttonPrimary: '#00b894',
                buttonPrimaryHover: '#00a383',
                buttonWarning: '#fdcb6e',
                buttonWarningHover: '#f9b851',
                buttonInfo: '#a29bfe',
                buttonInfoHover: '#8b84f0',
                buttonDanger: '#e17055',
                buttonDangerHover: '#d35f43'
            }
        ];

        // Default billing info structure
        const DEFAULT_BILLING_INFO = {
            contractor: {
                name: '',
                address: '',
                cityStateZip: '',
                phone: '',
                email: ''
            },
            client: {
                companyName: '',
                attn: '',
                address: '',
                cityStateZip: ''
            },
            hourlyRate: 0
        };

        // Memoized Clock Component - isolated to prevent re-renders
        const Clock = memo(() => {
            const [time, setTime] = useState(new Date());

            useEffect(() => {
                const timer = setInterval(() => {
                    setTime(new Date());
                }, 1000);

                return () => clearInterval(timer);
            }, []);

            return (
                <div className="clock">
                    {time.toLocaleTimeString()}
                </div>
            );
        });

        function TimeTracker() {
            const [activeTab, setActiveTab] = useState('tracker');
            const [isWorking, setIsWorking] = useState(false);
            const [isOnBreak, setIsOnBreak] = useState(false);
            const [currentSession, setCurrentSession] = useState(null);
            const [workSessions, setWorkSessions] = useState([]);
            const [currentTheme, setCurrentTheme] = useState(THEMES[0]);
            const [billingInfo, setBillingInfo] = useState(DEFAULT_BILLING_INFO);
            const [editingSession, setEditingSession] = useState(null);
            const [showBillingSetup, setShowBillingSetup] = useState(false);
            const [isInitialLoad, setIsInitialLoad] = useState(true);

            // Load data from localStorage on mount
            useEffect(() => {
                const savedSessions = localStorage.getItem('workSessions');
                if (savedSessions) {
                    setWorkSessions(JSON.parse(savedSessions));
                }
                
                const savedCurrentSession = localStorage.getItem('currentSession');
                if (savedCurrentSession) {
                    const session = JSON.parse(savedCurrentSession);
                    setCurrentSession(session);
                    setIsWorking(true);
                    setIsOnBreak(session.breaks.some(b => !b.endTime));
                }

                const savedTheme = localStorage.getItem('selectedTheme');
                if (savedTheme) {
                    const theme = THEMES.find(t => t.id === savedTheme);
                    if (theme) {
                        setCurrentTheme(theme);
                        applyTheme(theme);
                    }
                }

                const savedBillingInfo = localStorage.getItem('billingInfo');
                if (savedBillingInfo) {
                    setBillingInfo(JSON.parse(savedBillingInfo));
                } else {
                    // Show setup message if no billing info
                    setShowBillingSetup(true);
                }

                // Mark initial load as complete
                setIsInitialLoad(false);
            }, []);

            // Save to localStorage whenever sessions change (but not on initial load)
            useEffect(() => {
                if (!isInitialLoad) {
                    localStorage.setItem('workSessions', JSON.stringify(workSessions));
                }
            }, [workSessions, isInitialLoad]);

            useEffect(() => {
                if (!isInitialLoad) {
                    if (currentSession) {
                        localStorage.setItem('currentSession', JSON.stringify(currentSession));
                    } else {
                        localStorage.removeItem('currentSession');
                    }
                }
            }, [currentSession, isInitialLoad]);

            useEffect(() => {
                if (!isInitialLoad) {
                    localStorage.setItem('billingInfo', JSON.stringify(billingInfo));
                }
            }, [billingInfo, isInitialLoad]);

            const applyTheme = (theme) => {
                const root = document.documentElement;
                root.style.setProperty('--primary-start', theme.primaryStart);
                root.style.setProperty('--primary-end', theme.primaryEnd);
                root.style.setProperty('--button-primary', theme.buttonPrimary);
                root.style.setProperty('--button-primary-hover', theme.buttonPrimaryHover);
                root.style.setProperty('--button-warning', theme.buttonWarning);
                root.style.setProperty('--button-warning-hover', theme.buttonWarningHover);
                root.style.setProperty('--button-info', theme.buttonInfo);
                root.style.setProperty('--button-info-hover', theme.buttonInfoHover);
                root.style.setProperty('--button-danger', theme.buttonDanger);
                root.style.setProperty('--button-danger-hover', theme.buttonDangerHover);
            };

            const changeTheme = (theme) => {
                setCurrentTheme(theme);
                applyTheme(theme);
                localStorage.setItem('selectedTheme', theme.id);
            };

            const isBillingInfoComplete = () => {
                const { contractor, client, hourlyRate } = billingInfo;
                return contractor.name && contractor.email && 
                       client.companyName && hourlyRate > 0;
            };

            const startWorkDay = () => {
                const now = new Date().toISOString();
                setCurrentSession({
                    startTime: now,
                    endTime: null,
                    breaks: [],
                    notes: ''
                });
                setIsWorking(true);
                setIsOnBreak(false);
            };

            const startBreak = (reason = '') => {
                if (!currentSession) return;
                
                const now = new Date().toISOString();
                const updatedSession = {
                    ...currentSession,
                    breaks: [...currentSession.breaks, { startTime: now, endTime: null, reason }]
                };
                setCurrentSession(updatedSession);
                setIsOnBreak(true);
            };

            const endBreak = () => {
                if (!currentSession) return;
                
                const now = new Date().toISOString();
                const breaks = [...currentSession.breaks];
                const lastBreak = breaks[breaks.length - 1];
                if (lastBreak && !lastBreak.endTime) {
                    lastBreak.endTime = now;
                }
                
                setCurrentSession({ ...currentSession, breaks });
                setIsOnBreak(false);
            };

            const endWorkDay = (notes = '') => {
                if (!currentSession) return;
                
                const now = new Date().toISOString();
                const completedSession = {
                    ...currentSession,
                    endTime: now,
                    notes: notes || currentSession.notes
                };
                
                setWorkSessions([...workSessions, completedSession]);
                setCurrentSession(null);
                setIsWorking(false);
                setIsOnBreak(false);
            };

            const addManualSession = (sessionData) => {
                setWorkSessions([...workSessions, sessionData]);
            };

            const updateSession = (index, updatedSession) => {
                const newSessions = [...workSessions];
                newSessions[index] = updatedSession;
                setWorkSessions(newSessions);
            };

            const calculateHours = (session) => {
                if (!session.startTime || !session.endTime) return 0;
                
                const start = new Date(session.startTime);
                const end = new Date(session.endTime);
                let workMinutes = (end - start) / (1000 * 60);
                
                session.breaks.forEach(breakItem => {
                    if (breakItem.startTime && breakItem.endTime) {
                        const breakStart = new Date(breakItem.startTime);
                        const breakEnd = new Date(breakItem.endTime);
                        const breakMinutes = (breakEnd - breakStart) / (1000 * 60);
                        workMinutes -= breakMinutes;
                    }
                });
                
                return workMinutes / 60;
            };

            const exportData = () => {
                const dataStr = JSON.stringify({ workSessions, currentSession }, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `time-tracker-backup-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
            };

            const importData = (event) => {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        let data = JSON.parse(e.target.result);
                        
                        // Check if this is old format (has "sessions" instead of "workSessions")
                        if (data.sessions && !data.workSessions) {
                            // Convert old format to new format
                            const converted = {
                                workSessions: [],
                                currentSession: null
                            };
                            
                            // Convert sessions to workSessions
                            data.sessions.forEach(session => {
                                const newSession = {
                                    startTime: session.startTime,
                                    endTime: session.endTime,
                                    breaks: [],
                                    notes: session.notes || ''
                                };
                                
                                // Convert offlinePeriods to breaks
                                if (session.offlinePeriods) {
                                    session.offlinePeriods.forEach(period => {
                                        newSession.breaks.push({
                                            startTime: period.start,
                                            endTime: period.end,
                                            reason: period.reason || ''
                                        });
                                    });
                                }
                                
                                converted.workSessions.push(newSession);
                            });
                            
                            // Convert currentSession if exists
                            if (data.currentSession) {
                                const cs = data.currentSession;
                                converted.currentSession = {
                                    startTime: cs.startTime,
                                    endTime: cs.endTime || null,
                                    breaks: [],
                                    notes: cs.notes || ''
                                };
                                
                                if (cs.offlinePeriods) {
                                    cs.offlinePeriods.forEach(period => {
                                        converted.currentSession.breaks.push({
                                            startTime: period.start,
                                            endTime: period.end,
                                            reason: period.reason || ''
                                        });
                                    });
                                }
                            }
                            
                            data = converted;
                        }
                        
                        // Import the data (now in correct format)
                        if (data.workSessions) {
                            setWorkSessions(data.workSessions);
                        }
                        if (data.currentSession) {
                            setCurrentSession(data.currentSession);
                            setIsWorking(true);
                            setIsOnBreak(data.currentSession.breaks.some(b => !b.endTime));
                        }
                        alert('Data imported successfully!');
                    } catch (error) {
                        alert('Error importing data. Please check the file format.');
                    }
                };
                reader.readAsText(file);
                event.target.value = '';
            };

            const getHeaderSubtitle = () => {
                if (billingInfo.hourlyRate > 0) {
                    return `$${billingInfo.hourlyRate.toFixed(2)}/hour`;
                }
                return '';
            };

            return (
                <div className="container">
                    <div className="header">
                        <div className="theme-selector">
                            {THEMES.map(theme => (
                                <div
                                    key={theme.id}
                                    className={`theme-circle ${currentTheme.id === theme.id ? 'active' : ''}`}
                                    style={{
                                        background: `linear-gradient(135deg, ${theme.primaryStart} 0%, ${theme.primaryEnd} 100%)`
                                    }}
                                    onClick={() => changeTheme(theme)}
                                    title={theme.name}
                                />
                            ))}
                        </div>
                        <h1>‚è±Ô∏è Contractor Time Tracker</h1>
                        {getHeaderSubtitle() && <p>{getHeaderSubtitle()}</p>}
                    </div>

                    {showBillingSetup && !isBillingInfoComplete() && (
                        <div style={{ padding: '20px', background: '#fff3cd', borderBottom: '2px solid #ffeaa7' }}>
                            <div style={{ maxWidth: '800px', margin: '0 auto' }}>
                                <h3 style={{ color: '#856404', marginBottom: '10px' }}>‚ö†Ô∏è Setup Required</h3>
                                <p style={{ color: '#856404', marginBottom: '10px' }}>
                                    Please complete your billing information in the Settings tab before tracking time or generating invoices.
                                </p>
                                <button 
                                    onClick={() => {
                                        setActiveTab('settings');
                                        setShowBillingSetup(false);
                                    }}
                                    style={{
                                        background: '#ffc107',
                                        color: '#000',
                                        padding: '10px 20px',
                                        border: 'none',
                                        borderRadius: '8px',
                                        cursor: 'pointer',
                                        fontWeight: 'bold'
                                    }}
                                >
                                    Go to Settings
                                </button>
                            </div>
                        </div>
                    )}

                    <div className="tabs">
                        <button 
                            className={`tab ${activeTab === 'tracker' ? 'active' : ''}`}
                            onClick={() => setActiveTab('tracker')}
                        >
                            Time Tracker
                        </button>
                        <button 
                            className={`tab ${activeTab === 'manual' ? 'active' : ''}`}
                            onClick={() => setActiveTab('manual')}
                        >
                            Manual Entry
                        </button>
                        <button 
                            className={`tab ${activeTab === 'history' ? 'active' : ''}`}
                            onClick={() => setActiveTab('history')}
                        >
                            Work History
                        </button>
                        <button 
                            className={`tab ${activeTab === 'reports' ? 'active' : ''}`}
                            onClick={() => setActiveTab('reports')}
                        >
                            Reports & Invoices
                        </button>
                        <button 
                            className={`tab ${activeTab === 'settings' ? 'active' : ''}`}
                            onClick={() => setActiveTab('settings')}
                        >
                            Settings
                        </button>
                    </div>

                    <div className="content">
                        {activeTab === 'tracker' && (
                            <TrackerTab 
                                isWorking={isWorking}
                                isOnBreak={isOnBreak}
                                currentSession={currentSession}
                                startWorkDay={startWorkDay}
                                startBreak={startBreak}
                                endBreak={endBreak}
                                endWorkDay={endWorkDay}
                            />
                        )}
                        {activeTab === 'manual' && (
                            <ManualEntryTab 
                                addManualSession={addManualSession}
                            />
                        )}
                        {activeTab === 'history' && (
                            <HistoryTab 
                                workSessions={workSessions}
                                calculateHours={calculateHours}
                                setEditingSession={setEditingSession}
                            />
                        )}
                        {activeTab === 'reports' && (
                            <ReportsTab 
                                workSessions={workSessions}
                                calculateHours={calculateHours}
                                billingInfo={billingInfo}
                                isBillingInfoComplete={isBillingInfoComplete}
                            />
                        )}
                        {activeTab === 'settings' && (
                            <SettingsTab 
                                exportData={exportData}
                                importData={importData}
                                workSessions={workSessions}
                                setWorkSessions={setWorkSessions}
                                billingInfo={billingInfo}
                                setBillingInfo={setBillingInfo}
                                setCurrentSession={setCurrentSession}
                            />
                        )}
                    </div>

                    {editingSession && (
                        <EditSessionModal
                            session={editingSession.session}
                            sessionIndex={editingSession.index}
                            onClose={() => setEditingSession(null)}
                            onSave={updateSession}
                            calculateHours={calculateHours}
                        />
                    )}
                </div>
            );
        }

        function TrackerTab({ isWorking, isOnBreak, currentSession, startWorkDay, startBreak, endBreak, endWorkDay }) {
            return (
                <>
                    <Clock />
                    
                    <div className={`status ${isWorking ? (isOnBreak ? 'offline' : 'working') : 'off'}`}>
                        {!isWorking && '‚ö´ Not Working'}
                        {isWorking && !isOnBreak && 'üü¢ Working'}
                        {isWorking && isOnBreak && 'üü° On Break'}
                    </div>

                    {currentSession && (
                        <div style={{ textAlign: 'center', color: '#6c757d', marginBottom: '20px' }}>
                            Started at: {new Date(currentSession.startTime).toLocaleString()}
                            {currentSession.breaks.length > 0 && (
                                <div style={{ marginTop: '10px' }}>
                                    Total breaks today: {currentSession.breaks.length}
                                </div>
                            )}
                        </div>
                    )}

                    <div className="button-group">
                        <button 
                            className="btn-start"
                            onClick={startWorkDay}
                            disabled={isWorking}
                        >
                            Start Work Day
                        </button>
                        <BreakButton 
                            isWorking={isWorking}
                            isOnBreak={isOnBreak}
                            startBreak={startBreak}
                        />
                        <button 
                            className="btn-return"
                            onClick={endBreak}
                            disabled={!isOnBreak}
                        >
                            Return from Break
                        </button>
                        <EndDayButton 
                            isWorking={isWorking}
                            isOnBreak={isOnBreak}
                            endWorkDay={endWorkDay}
                        />
                    </div>
                </>
            );
        }

        // Memoized BreakButton to prevent unnecessary re-renders
        const BreakButton = memo(({ isWorking, isOnBreak, startBreak }) => {
            const [showReasonInput, setShowReasonInput] = useState(false);
            const [breakReason, setBreakReason] = useState('');

            const handleStartBreak = () => {
                startBreak(breakReason);
                setBreakReason('');
                setShowReasonInput(false);
            };

            return (
                <>
                    <button 
                        className="btn-break"
                        onClick={() => setShowReasonInput(true)}
                        disabled={!isWorking || isOnBreak}
                    >
                        Start Break
                    </button>
                    {showReasonInput && (
                        <div style={{ width: '100%', marginTop: '10px' }}>
                            <input
                                type="text"
                                value={breakReason}
                                onChange={(e) => setBreakReason(e.target.value)}
                                placeholder="Break reason (optional)"
                                autoComplete="off"
                                style={{
                                    width: '100%',
                                    padding: '10px',
                                    border: '2px solid #dee2e6',
                                    borderRadius: '8px',
                                    fontSize: '16px'
                                }}
                            />
                            <div style={{ display: 'flex', gap: '10px', marginTop: '10px' }}>
                                <button onClick={handleStartBreak} className="btn-break">
                                    Confirm Break
                                </button>
                                <button onClick={() => {
                                    setShowReasonInput(false);
                                    setBreakReason('');
                                }} className="btn-import">
                                    Cancel
                                </button>
                            </div>
                        </div>
                    )}
                </>
            );
        });

        // Memoized EndDayButton to prevent unnecessary re-renders
        const EndDayButton = memo(({ isWorking, isOnBreak, endWorkDay }) => {
            const [showNotesInput, setShowNotesInput] = useState(false);
            const [notes, setNotes] = useState('');

            const handleEndDay = () => {
                endWorkDay(notes);
                setNotes('');
                setShowNotesInput(false);
            };

            return (
                <>
                    <button 
                        className="btn-end"
                        onClick={() => setShowNotesInput(true)}
                        disabled={!isWorking || isOnBreak}
                    >
                        End Work Day
                    </button>
                    {showNotesInput && (
                        <div style={{ width: '100%', marginTop: '10px' }}>
                            <textarea
                                value={notes}
                                onChange={(e) => setNotes(e.target.value)}
                                placeholder="Notes for today (optional)"
                                autoComplete="off"
                                style={{
                                    width: '100%',
                                    padding: '10px',
                                    border: '2px solid #dee2e6',
                                    borderRadius: '8px',
                                    fontSize: '16px',
                                    minHeight: '80px',
                                    resize: 'vertical'
                                }}
                            />
                            <div style={{ display: 'flex', gap: '10px', marginTop: '10px' }}>
                                <button onClick={handleEndDay} className="btn-end">
                                    Confirm End Day
                                </button>
                                <button onClick={() => {
                                    setShowNotesInput(false);
                                    setNotes('');
                                }} className="btn-import">
                                    Cancel
                                </button>
                            </div>
                        </div>
                    )}
                </>
            );
        });

        function ManualEntryTab({ addManualSession }) {
            const [formData, setFormData] = useState({
                date: '',
                startTime: '',
                endTime: '',
                notes: ''
            });
            const [breaks, setBreaks] = useState([]);
            const [currentBreak, setCurrentBreak] = useState({ startTime: '', endTime: '', reason: '' });
            const [message, setMessage] = useState({ text: '', type: '' });

            const handleInputChange = (field, value) => {
                setFormData(prev => ({ ...prev, [field]: value }));
            };

            const handleBreakChange = (field, value) => {
                setCurrentBreak(prev => ({ ...prev, [field]: value }));
            };

            const addBreak = () => {
                if (currentBreak.startTime && currentBreak.endTime) {
                    setBreaks([...breaks, currentBreak]);
                    setCurrentBreak({ startTime: '', endTime: '', reason: '' });
                } else {
                    setMessage({ text: 'Please fill in break start and end times', type: 'error' });
                    setTimeout(() => setMessage({ text: '', type: '' }), 3000);
                }
            };

            const removeBreak = (index) => {
                setBreaks(breaks.filter((_, i) => i !== index));
            };

            const calculateExpectedHours = () => {
                if (!formData.date || !formData.startTime || !formData.endTime) return 0;

                const start = new Date(`${formData.date}T${formData.startTime}`);
                const end = new Date(`${formData.date}T${formData.endTime}`);
                
                let workMinutes = (end - start) / (1000 * 60);

                breaks.forEach(breakItem => {
                    if (breakItem.startTime && breakItem.endTime) {
                        const breakStart = new Date(`${formData.date}T${breakItem.startTime}`);
                        const breakEnd = new Date(`${formData.date}T${breakItem.endTime}`);
                        const breakMinutes = (breakEnd - breakStart) / (1000 * 60);
                        workMinutes -= breakMinutes;
                    }
                });

                return (workMinutes / 60).toFixed(2);
            };

            const handleSubmit = () => {
                // Validation
                if (!formData.date || !formData.startTime || !formData.endTime) {
                    setMessage({ text: 'Please fill in date, start time, and end time', type: 'error' });
                    setTimeout(() => setMessage({ text: '', type: '' }), 3000);
                    return;
                }

                const start = new Date(`${formData.date}T${formData.startTime}`);
                const end = new Date(`${formData.date}T${formData.endTime}`);

                if (end <= start) {
                    setMessage({ text: 'End time must be after start time', type: 'error' });
                    setTimeout(() => setMessage({ text: '', type: '' }), 3000);
                    return;
                }

                // Validate breaks
                for (let breakItem of breaks) {
                    const breakStart = new Date(`${formData.date}T${breakItem.startTime}`);
                    const breakEnd = new Date(`${formData.date}T${breakItem.endTime}`);

                    if (breakEnd <= breakStart) {
                        setMessage({ text: 'Break end time must be after break start time', type: 'error' });
                        setTimeout(() => setMessage({ text: '', type: '' }), 3000);
                        return;
                    }

                    if (breakStart < start || breakEnd > end) {
                        setMessage({ text: 'Breaks must be within work session times', type: 'error' });
                        setTimeout(() => setMessage({ text: '', type: '' }), 3000);
                        return;
                    }
                }

                // Create session object
                const session = {
                    startTime: new Date(`${formData.date}T${formData.startTime}`).toISOString(),
                    endTime: new Date(`${formData.date}T${formData.endTime}`).toISOString(),
                    breaks: breaks.map(b => ({
                        startTime: new Date(`${formData.date}T${b.startTime}`).toISOString(),
                        endTime: new Date(`${formData.date}T${b.endTime}`).toISOString(),
                        reason: b.reason
                    })),
                    notes: formData.notes
                };

                addManualSession(session);

                // Reset form
                setFormData({ date: '', startTime: '', endTime: '', notes: '' });
                setBreaks([]);
                setMessage({ text: `Successfully added work session! (${calculateExpectedHours()} hours)`, type: 'success' });
                setTimeout(() => setMessage({ text: '', type: '' }), 5000);
            };

            return (
                <div>
                    <h2 style={{ color: 'var(--primary-start)', marginBottom: '20px' }}>Add Historical Work Session</h2>
                    
                    {message.text && (
                        <div className={message.type === 'success' ? 'success-message' : 'error-message'}>
                            {message.text}
                        </div>
                    )}

                    <div className="manual-entry-form">
                        <h3>Work Session Details</h3>
                        
                        <div className="form-row">
                            <div className="input-group">
                                <label>Date</label>
                                <input
                                    type="date"
                                    value={formData.date}
                                    onChange={(e) => handleInputChange('date', e.target.value)}
                                    max={new Date().toISOString().split('T')[0]}
                                />
                            </div>
                            <div className="input-group">
                                <label>Start Time</label>
                                <input
                                    type="time"
                                    value={formData.startTime}
                                    onChange={(e) => handleInputChange('startTime', e.target.value)}
                                />
                            </div>
                            <div className="input-group">
                                <label>End Time</label>
                                <input
                                    type="time"
                                    value={formData.endTime}
                                    onChange={(e) => handleInputChange('endTime', e.target.value)}
                                />
                            </div>
                        </div>

                        <div className="input-group">
                            <label>Notes (Optional)</label>
                            <textarea
                                value={formData.notes}
                                onChange={(e) => handleInputChange('notes', e.target.value)}
                                placeholder="Any notes about this work session..."
                            />
                        </div>

                        {formData.date && formData.startTime && formData.endTime && (
                            <div style={{ 
                                background: '#e7f3ff', 
                                padding: '15px', 
                                borderRadius: '8px',
                                marginTop: '15px',
                                fontWeight: 'bold',
                                color: '#0066cc'
                            }}>
                                Expected Hours: {calculateExpectedHours()} hours
                            </div>
                        )}
                    </div>

                    <div className="manual-entry-form" style={{ marginTop: '20px' }}>
                        <h3>Breaks (Optional)</h3>
                        
                        <div className="form-row">
                            <div className="input-group">
                                <label>Break Start Time</label>
                                <input
                                    type="time"
                                    value={currentBreak.startTime}
                                    onChange={(e) => handleBreakChange('startTime', e.target.value)}
                                />
                            </div>
                            <div className="input-group">
                                <label>Break End Time</label>
                                <input
                                    type="time"
                                    value={currentBreak.endTime}
                                    onChange={(e) => handleBreakChange('endTime', e.target.value)}
                                />
                            </div>
                            <div className="input-group">
                                <label>Reason (Optional)</label>
                                <input
                                    type="text"
                                    value={currentBreak.reason}
                                    onChange={(e) => handleBreakChange('reason', e.target.value)}
                                    placeholder="Lunch, personal, etc."
                                />
                            </div>
                        </div>

                        <button onClick={addBreak} className="btn-add" style={{ marginTop: '10px' }}>
                            Add Break
                        </button>

                        {breaks.length > 0 && (
                            <div style={{ marginTop: '20px' }}>
                                <h4 style={{ marginBottom: '10px' }}>Added Breaks:</h4>
                                {breaks.map((breakItem, index) => (
                                    <div key={index} className="break-item" style={{ 
                                        display: 'flex', 
                                        justifyContent: 'space-between',
                                        alignItems: 'center',
                                        marginBottom: '10px'
                                    }}>
                                        <span>
                                            {breakItem.startTime} - {breakItem.endTime}
                                            {breakItem.reason && ` (${breakItem.reason})`}
                                        </span>
                                        <button 
                                            onClick={() => removeBreak(index)}
                                            style={{
                                                background: '#dc3545',
                                                color: 'white',
                                                border: 'none',
                                                padding: '5px 15px',
                                                borderRadius: '5px',
                                                cursor: 'pointer'
                                            }}
                                        >
                                            Remove
                                        </button>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>

                    <div className="button-group" style={{ marginTop: '30px' }}>
                        <button onClick={handleSubmit} className="btn-add">
                            Add Work Session
                        </button>
                    </div>
                </div>
            );
        }

        function HistoryTab({ workSessions, calculateHours, setEditingSession }) {
            const sortedSessions = [...workSessions].sort((a, b) => 
                new Date(b.startTime) - new Date(a.startTime)
            );

            const isSessionOld = (session) => {
                const sessionDate = new Date(session.startTime);
                const fourteenDaysAgo = new Date();
                fourteenDaysAgo.setDate(fourteenDaysAgo.getDate() - 14);
                return sessionDate < fourteenDaysAgo;
            };

            return (
                <div>
                    <h2 style={{ color: 'var(--primary-start)', marginBottom: '20px' }}>Work History</h2>
                    
                    {sortedSessions.length === 0 ? (
                        <p style={{ textAlign: 'center', color: '#6c757d', padding: '40px' }}>
                            No work sessions recorded yet. Start tracking or add manual entries!
                        </p>
                    ) : (
                        sortedSessions.map((session, index) => {
                            const actualIndex = workSessions.findIndex(s => s === session);
                            const isOld = isSessionOld(session);
                            
                            return (
                                <div key={index} className="session-card">
                                    <div className="session-header">
                                        <div className="session-date">
                                            {new Date(session.startTime).toLocaleDateString('en-US', { 
                                                weekday: 'long',
                                                year: 'numeric',
                                                month: 'long',
                                                day: 'numeric'
                                            })}
                                        </div>
                                        <div style={{ display: 'flex', gap: '10px', alignItems: 'center' }}>
                                            <div className="session-hours">
                                                {calculateHours(session).toFixed(2)} hours
                                            </div>
                                            {isOld ? (
                                                <div className="tooltip">
                                                    <button className="btn-edit" disabled>
                                                        Edit
                                                    </button>
                                                    <span className="tooltiptext">Cannot edit sessions older than 14 days</span>
                                                </div>
                                            ) : (
                                                <button 
                                                    className="btn-edit"
                                                    onClick={() => setEditingSession({ session, index: actualIndex })}
                                                >
                                                    Edit
                                                </button>
                                            )}
                                        </div>
                                    </div>
                                    <div className="session-details">
                                        <div>
                                            ‚è∞ {new Date(session.startTime).toLocaleTimeString()} - {new Date(session.endTime).toLocaleTimeString()}
                                        </div>
                                        {session.breaks.length > 0 && (
                                            <div style={{ marginTop: '10px' }}>
                                                <strong>Breaks ({session.breaks.length}):</strong>
                                                {session.breaks.map((breakItem, i) => (
                                                    <div key={i} className="break-item">
                                                        {new Date(breakItem.startTime).toLocaleTimeString()} - {new Date(breakItem.endTime).toLocaleTimeString()}
                                                        {breakItem.reason && ` - ${breakItem.reason}`}
                                                        {' '}({((new Date(breakItem.endTime) - new Date(breakItem.startTime)) / (1000 * 60)).toFixed(0)} min)
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                        {session.notes && (
                                            <div style={{ marginTop: '10px' }}>
                                                <strong>Notes:</strong> {session.notes}
                                            </div>
                                        )}
                                    </div>
                                </div>
                            );
                        })
                    )}
                </div>
            );
        }

        function EditSessionModal({ session, sessionIndex, onClose, onSave, calculateHours }) {
            const [formData, setFormData] = useState({
                date: new Date(session.startTime).toISOString().split('T')[0],
                startTime: new Date(session.startTime).toTimeString().slice(0, 5),
                endTime: new Date(session.endTime).toTimeString().slice(0, 5),
                notes: session.notes || ''
            });
            const [breaks, setBreaks] = useState(session.breaks.map(b => ({
                startTime: new Date(b.startTime).toTimeString().slice(0, 5),
                endTime: new Date(b.endTime).toTimeString().slice(0, 5),
                reason: b.reason || ''
            })));
            const [currentBreak, setCurrentBreak] = useState({ startTime: '', endTime: '', reason: '' });
            const [message, setMessage] = useState({ text: '', type: '' });

            const handleInputChange = (field, value) => {
                setFormData(prev => ({ ...prev, [field]: value }));
            };

            const handleBreakChange = (field, value) => {
                setCurrentBreak(prev => ({ ...prev, [field]: value }));
            };

            const addBreak = () => {
                if (currentBreak.startTime && currentBreak.endTime) {
                    setBreaks([...breaks, currentBreak]);
                    setCurrentBreak({ startTime: '', endTime: '', reason: '' });
                } else {
                    setMessage({ text: 'Please fill in break start and end times', type: 'error' });
                    setTimeout(() => setMessage({ text: '', type: '' }), 3000);
                }
            };

            const removeBreak = (index) => {
                setBreaks(breaks.filter((_, i) => i !== index));
            };

            const calculateExpectedHours = () => {
                if (!formData.date || !formData.startTime || !formData.endTime) return 0;

                const start = new Date(`${formData.date}T${formData.startTime}`);
                const end = new Date(`${formData.date}T${formData.endTime}`);
                
                let workMinutes = (end - start) / (1000 * 60);

                breaks.forEach(breakItem => {
                    if (breakItem.startTime && breakItem.endTime) {
                        const breakStart = new Date(`${formData.date}T${breakItem.startTime}`);
                        const breakEnd = new Date(`${formData.date}T${breakItem.endTime}`);
                        const breakMinutes = (breakEnd - breakStart) / (1000 * 60);
                        workMinutes -= breakMinutes;
                    }
                });

                return (workMinutes / 60).toFixed(2);
            };

            const handleSave = () => {
                // Validation
                if (!formData.date || !formData.startTime || !formData.endTime) {
                    setMessage({ text: 'Please fill in date, start time, and end time', type: 'error' });
                    setTimeout(() => setMessage({ text: '', type: '' }), 3000);
                    return;
                }

                const start = new Date(`${formData.date}T${formData.startTime}`);
                const end = new Date(`${formData.date}T${formData.endTime}`);

                if (end <= start) {
                    setMessage({ text: 'End time must be after start time', type: 'error' });
                    setTimeout(() => setMessage({ text: '', type: '' }), 3000);
                    return;
                }

                // Validate breaks
                for (let breakItem of breaks) {
                    const breakStart = new Date(`${formData.date}T${breakItem.startTime}`);
                    const breakEnd = new Date(`${formData.date}T${breakItem.endTime}`);

                    if (breakEnd <= breakStart) {
                        setMessage({ text: 'Break end time must be after break start time', type: 'error' });
                        setTimeout(() => setMessage({ text: '', type: '' }), 3000);
                        return;
                    }

                    if (breakStart < start || breakEnd > end) {
                        setMessage({ text: 'Breaks must be within work session times', type: 'error' });
                        setTimeout(() => setMessage({ text: '', type: '' }), 3000);
                        return;
                    }
                }

                // Create updated session object
                const updatedSession = {
                    startTime: new Date(`${formData.date}T${formData.startTime}`).toISOString(),
                    endTime: new Date(`${formData.date}T${formData.endTime}`).toISOString(),
                    breaks: breaks.map(b => ({
                        startTime: new Date(`${formData.date}T${b.startTime}`).toISOString(),
                        endTime: new Date(`${formData.date}T${b.endTime}`).toISOString(),
                        reason: b.reason
                    })),
                    notes: formData.notes
                };

                onSave(sessionIndex, updatedSession);
                onClose();
            };

            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal" onClick={(e) => e.stopPropagation()}>
                        <div className="modal-header">
                            <h2>Edit Work Session</h2>
                        </div>
                        <div className="modal-content">
                            {message.text && (
                                <div className={message.type === 'success' ? 'success-message' : 'error-message'}>
                                    {message.text}
                                </div>
                            )}

                            <div className="manual-entry-form">
                                <h3>Work Session Details</h3>
                                
                                <div className="form-row">
                                    <div className="input-group">
                                        <label>Date</label>
                                        <input
                                            type="date"
                                            value={formData.date}
                                            onChange={(e) => handleInputChange('date', e.target.value)}
                                            max={new Date().toISOString().split('T')[0]}
                                        />
                                    </div>
                                    <div className="input-group">
                                        <label>Start Time</label>
                                        <input
                                            type="time"
                                            value={formData.startTime}
                                            onChange={(e) => handleInputChange('startTime', e.target.value)}
                                        />
                                    </div>
                                    <div className="input-group">
                                        <label>End Time</label>
                                        <input
                                            type="time"
                                            value={formData.endTime}
                                            onChange={(e) => handleInputChange('endTime', e.target.value)}
                                        />
                                    </div>
                                </div>

                                <div className="input-group">
                                    <label>Notes (Optional)</label>
                                    <textarea
                                        value={formData.notes}
                                        onChange={(e) => handleInputChange('notes', e.target.value)}
                                        placeholder="Any notes about this work session..."
                                    />
                                </div>

                                {formData.date && formData.startTime && formData.endTime && (
                                    <div style={{ 
                                        background: '#e7f3ff', 
                                        padding: '15px', 
                                        borderRadius: '8px',
                                        marginTop: '15px',
                                        fontWeight: 'bold',
                                        color: '#0066cc'
                                    }}>
                                        Expected Hours: {calculateExpectedHours()} hours
                                    </div>
                                )}
                            </div>

                            <div className="manual-entry-form" style={{ marginTop: '20px' }}>
                                <h3>Breaks</h3>
                                
                                {breaks.length > 0 && (
                                    <div style={{ marginBottom: '20px' }}>
                                        <h4 style={{ marginBottom: '10px' }}>Current Breaks:</h4>
                                        {breaks.map((breakItem, index) => (
                                            <div key={index} className="break-item" style={{ 
                                                display: 'flex', 
                                                justifyContent: 'space-between',
                                                alignItems: 'center',
                                                marginBottom: '10px'
                                            }}>
                                                <span>
                                                    {breakItem.startTime} - {breakItem.endTime}
                                                    {breakItem.reason && ` (${breakItem.reason})`}
                                                </span>
                                                <button 
                                                    onClick={() => removeBreak(index)}
                                                    style={{
                                                        background: '#dc3545',
                                                        color: 'white',
                                                        border: 'none',
                                                        padding: '5px 15px',
                                                        borderRadius: '5px',
                                                        cursor: 'pointer'
                                                    }}
                                                >
                                                    Remove
                                                </button>
                                            </div>
                                        ))}
                                    </div>
                                )}

                                <h4 style={{ marginBottom: '10px' }}>Add New Break:</h4>
                                <div className="form-row">
                                    <div className="input-group">
                                        <label>Break Start Time</label>
                                        <input
                                            type="time"
                                            value={currentBreak.startTime}
                                            onChange={(e) => handleBreakChange('startTime', e.target.value)}
                                        />
                                    </div>
                                    <div className="input-group">
                                        <label>Break End Time</label>
                                        <input
                                            type="time"
                                            value={currentBreak.endTime}
                                            onChange={(e) => handleBreakChange('endTime', e.target.value)}
                                        />
                                    </div>
                                    <div className="input-group">
                                        <label>Reason (Optional)</label>
                                        <input
                                            type="text"
                                            value={currentBreak.reason}
                                            onChange={(e) => handleBreakChange('reason', e.target.value)}
                                            placeholder="Lunch, personal, etc."
                                        />
                                    </div>
                                </div>

                                <button onClick={addBreak} className="btn-add" style={{ marginTop: '10px' }}>
                                    Add Break
                                </button>
                            </div>
                        </div>
                        <div className="modal-footer">
                            <button onClick={onClose} className="btn-import">
                                Cancel
                            </button>
                            <button onClick={handleSave} className="btn-add">
                                Save Changes
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        function ReportsTab({ workSessions, calculateHours, billingInfo, isBillingInfoComplete }) {
            const [reportPeriod, setReportPeriod] = useState('biweekly');
            const [startDate, setStartDate] = useState('');
            const [endDate, setEndDate] = useState('');

            const getDateRange = () => {
                const today = new Date();
                let start, end;

                if (reportPeriod === 'custom' && startDate && endDate) {
                    start = new Date(startDate);
                    end = new Date(endDate);
                    end.setHours(23, 59, 59, 999);
                } else if (reportPeriod === 'daily') {
                    start = new Date(today.setHours(0, 0, 0, 0));
                    end = new Date(today.setHours(23, 59, 59, 999));
                } else if (reportPeriod === 'weekly') {
                    start = new Date(today);
                    start.setDate(today.getDate() - 7);
                    start.setHours(0, 0, 0, 0);
                    end = new Date(today.setHours(23, 59, 59, 999));
                } else { // biweekly
                    start = new Date(today);
                    start.setDate(today.getDate() - 14);
                    start.setHours(0, 0, 0, 0);
                    end = new Date(today.setHours(23, 59, 59, 999));
                }

                return { start, end };
            };

            const { start, end } = getDateRange();

            const filteredSessions = workSessions.filter(session => {
                const sessionDate = new Date(session.startTime);
                return sessionDate >= start && sessionDate <= end;
            });

            const totalHours = filteredSessions.reduce((sum, session) => sum + calculateHours(session), 0);
            const totalAmount = totalHours * billingInfo.hourlyRate;

            const generateExcelInvoice = () => {
                if (!isBillingInfoComplete()) {
                    alert('Please complete your billing information in Settings before generating invoices.');
                    return;
                }

                const wb = XLSX.utils.book_new();
                
                // Build invoice data array
                const invoiceData = [];
                
                // Title Row
                invoiceData.push(['INVOICE']);
                invoiceData.push(['']);
                
                // From Section
                invoiceData.push(['From:']);
                invoiceData.push([billingInfo.contractor.name]);
                invoiceData.push([billingInfo.contractor.address]);
                invoiceData.push([billingInfo.contractor.cityStateZip]);
                invoiceData.push(['Phone: ' + billingInfo.contractor.phone]);
                invoiceData.push(['Email: ' + billingInfo.contractor.email]);
                invoiceData.push(['']);
                
                // To Section
                invoiceData.push(['To:']);
                invoiceData.push([billingInfo.client.companyName]);
                invoiceData.push(['Attn: ' + billingInfo.client.attn]);
                invoiceData.push([billingInfo.client.address]);
                invoiceData.push([billingInfo.client.cityStateZip]);
                invoiceData.push(['']);
                
                // Invoice Info
                invoiceData.push(['Invoice Date:', new Date().toLocaleDateString()]);
                invoiceData.push(['Invoice Period:', `${start.toLocaleDateString()} - ${end.toLocaleDateString()}`]);
                invoiceData.push(['']);
                
                // Header Row for Data Table
                const headerRowIndex = invoiceData.length;
                invoiceData.push(['Date', 'Start Time', 'End Time', 'Break Count', 'Break Details', 'Notes', 'Hours', 'Rate', 'Amount']);
                
                // Data Rows
                let rowIndex = headerRowIndex + 1;
                filteredSessions.forEach((session, sessionIndex) => {
                    const hours = calculateHours(session);
                    const date = new Date(session.startTime).toLocaleDateString();
                    const startTime = new Date(session.startTime).toLocaleTimeString();
                    const endTime = new Date(session.endTime).toLocaleTimeString();
                    const breakCount = session.breaks.length;
                    
                    // Format break details
                    let breakDetails = '';
                    if (session.breaks.length > 0) {
                        const breakStrings = session.breaks.map(b => {
                            const bStart = new Date(b.startTime).toLocaleTimeString();
                            const bEnd = new Date(b.endTime).toLocaleTimeString();
                            const duration = ((new Date(b.endTime) - new Date(b.startTime)) / (1000 * 60)).toFixed(0);
                            return `${bStart}-${bEnd}${b.reason ? ' (' + b.reason + ')' : ''} [${duration}min]`;
                        });
                        breakDetails = breakStrings.join('; ');
                    }
                    
                    // Main session row
                    invoiceData.push([
                        date,
                        startTime,
                        endTime,
                        breakCount,
                        breakDetails,
                        session.notes || '',
                        hours.toFixed(2),
                        billingInfo.hourlyRate.toFixed(2),
                        (hours * billingInfo.hourlyRate).toFixed(2)
                    ]);
                    
                    rowIndex++;
                });
                
                // Totals
                invoiceData.push(['']);
                invoiceData.push(['', '', '', '', '', 'TOTAL HOURS:', totalHours.toFixed(2), '', '']);
                invoiceData.push(['', '', '', '', '', 'TOTAL AMOUNT:', '', '', totalAmount.toFixed(2)]);
                
                // Create worksheet
                const ws = XLSX.utils.aoa_to_sheet(invoiceData);
                
                // Set column widths
                ws['!cols'] = [
                    { wch: 12 },  // Date
                    { wch: 12 },  // Start Time
                    { wch: 12 },  // End Time
                    { wch: 12 },  // Break Count
                    { wch: 40 },  // Break Details
                    { wch: 30 },  // Notes
                    { wch: 10 },  // Hours
                    { wch: 10 },  // Rate
                    { wch: 12 }   // Amount
                ];
                
                // Apply cell styling
                const range = XLSX.utils.decode_range(ws['!ref']);
                
                // Style the title
                if (ws['A1']) {
                    ws['A1'].s = {
                        font: { bold: true, sz: 18, color: { rgb: "667eea" } },
                        alignment: { horizontal: "left", vertical: "center" }
                    };
                }
                
                // Style section headers (From:, To:)
                ['A3', 'A10'].forEach(cell => {
                    if (ws[cell]) {
                        ws[cell].s = {
                            font: { bold: true, sz: 11 },
                            alignment: { horizontal: "left", vertical: "center" }
                        };
                    }
                });
                
                // Style invoice info labels
                [`A${headerRowIndex - 2}`, `A${headerRowIndex - 1}`].forEach(cell => {
                    if (ws[cell]) {
                        ws[cell].s = {
                            font: { bold: true },
                            alignment: { horizontal: "left", vertical: "center" }
                        };
                    }
                });
                
                // Style header row
                for (let col = 0; col <= 8; col++) {
                    const cellAddr = XLSX.utils.encode_cell({ r: headerRowIndex, c: col });
                    if (ws[cellAddr]) {
                        ws[cellAddr].s = {
                            font: { bold: true, color: { rgb: "FFFFFF" } },
                            fill: { fgColor: { rgb: "667eea" } },
                            alignment: { horizontal: "center", vertical: "center" },
                            border: {
                                top: { style: "thin", color: { rgb: "000000" } },
                                bottom: { style: "thin", color: { rgb: "000000" } },
                                left: { style: "thin", color: { rgb: "000000" } },
                                right: { style: "thin", color: { rgb: "000000" } }
                            }
                        };
                    }
                }
                
                // Style data rows with alternating colors
                for (let row = headerRowIndex + 1; row < headerRowIndex + 1 + filteredSessions.length; row++) {
                    const isEvenRow = (row - headerRowIndex - 1) % 2 === 0;
                    const fillColor = isEvenRow ? "FFFFFF" : "F8F9FA";
                    
                    // Check if session has breaks for highlighting
                    const sessionIdx = row - headerRowIndex - 1;
                    const hasBreaks = filteredSessions[sessionIdx] && filteredSessions[sessionIdx].breaks.length > 0;
                    const breakFillColor = hasBreaks ? "FFF3CD" : fillColor;
                    
                    for (let col = 0; col <= 8; col++) {
                        const cellAddr = XLSX.utils.encode_cell({ r: row, c: col });
                        if (ws[cellAddr]) {
                            ws[cellAddr].s = {
                                fill: { fgColor: { rgb: col === 3 || col === 4 ? breakFillColor : fillColor } },
                                alignment: { 
                                    horizontal: col === 5 ? "left" : "center", 
                                    vertical: "top",
                                    wrapText: col === 4 || col === 5 // Wrap text for break details and notes
                                },
                                border: {
                                    top: { style: "thin", color: { rgb: "E0E0E0" } },
                                    bottom: { style: "thin", color: { rgb: "E0E0E0" } },
                                    left: { style: "thin", color: { rgb: "E0E0E0" } },
                                    right: { style: "thin", color: { rgb: "E0E0E0" } }
                                }
                            };
                            
                            // Format currency columns
                            if (col === 7 || col === 8) {
                                ws[cellAddr].z = col === 7 ? '0.00' : '"$"#,##0.00';
                            }
                        }
                    }
                }
                
                // Style total rows
                const totalRowStart = headerRowIndex + 1 + filteredSessions.length + 1;
                for (let row = totalRowStart; row <= totalRowStart + 1; row++) {
                    for (let col = 0; col <= 8; col++) {
                        const cellAddr = XLSX.utils.encode_cell({ r: row, c: col });
                        if (ws[cellAddr]) {
                            ws[cellAddr].s = {
                                font: { bold: true, sz: 11 },
                                fill: { fgColor: { rgb: "E8EAF6" } },
                                alignment: { horizontal: col === 6 || col === 8 ? "right" : "center", vertical: "center" },
                                border: {
                                    top: { style: "medium", color: { rgb: "667eea" } },
                                    bottom: { style: "medium", color: { rgb: "667eea" } }
                                }
                            };
                            
                            // Format currency in total
                            if (col === 8) {
                                ws[cellAddr].z = '"$"#,##0.00';
                            }
                        }
                    }
                }
                
                // Set row heights
                if (!ws['!rows']) ws['!rows'] = [];
                ws['!rows'][0] = { hpt: 30 }; // Title row height
                for (let row = headerRowIndex + 1; row < headerRowIndex + 1 + filteredSessions.length; row++) {
                    ws['!rows'][row] = { hpt: 30 }; // Data row height
                }
                
                XLSX.utils.book_append_sheet(wb, ws, 'Invoice');
                XLSX.writeFile(wb, `Invoice_${start.toISOString().split('T')[0]}_to_${end.toISOString().split('T')[0]}.xlsx`);
            };

            const generateCSV = () => {
                if (!isBillingInfoComplete()) {
                    alert('Please complete your billing information in Settings before generating reports.');
                    return;
                }

                // CSV Header - comprehensive columns for importing
                let csv = 'Date,Day,Start Time,End Time,Break Count,Total Break Minutes,Break Details,Hours Worked,Hourly Rate,Amount,Notes\n';
                
                filteredSessions.forEach(session => {
                    const date = new Date(session.startTime).toLocaleDateString();
                    const day = new Date(session.startTime).toLocaleDateString('en-US', { weekday: 'long' });
                    const startTime = new Date(session.startTime).toLocaleTimeString();
                    const endTime = new Date(session.endTime).toLocaleTimeString();
                    const breakCount = session.breaks.length;
                    
                    // Calculate total break minutes
                    let totalBreakMinutes = 0;
                    session.breaks.forEach(b => {
                        totalBreakMinutes += (new Date(b.endTime) - new Date(b.startTime)) / (1000 * 60);
                    });
                    
                    // Format break details for CSV
                    let breakDetails = '';
                    if (session.breaks.length > 0) {
                        const breakStrings = session.breaks.map(b => {
                            const bStart = new Date(b.startTime).toLocaleTimeString();
                            const bEnd = new Date(b.endTime).toLocaleTimeString();
                            const duration = ((new Date(b.endTime) - new Date(b.startTime)) / (1000 * 60)).toFixed(0);
                            return `${bStart}-${bEnd}${b.reason ? ' (' + b.reason + ')' : ''} [${duration}min]`;
                        });
                        breakDetails = breakStrings.join('; ');
                    }
                    
                    const hours = calculateHours(session).toFixed(2);
                    const rate = billingInfo.hourlyRate.toFixed(2);
                    const amount = (hours * billingInfo.hourlyRate).toFixed(2);
                    const notes = (session.notes || '').replace(/"/g, '""'); // Escape quotes for CSV
                    
                    csv += `"${date}","${day}","${startTime}","${endTime}",${breakCount},${totalBreakMinutes.toFixed(0)},"${breakDetails}",${hours},${rate},${amount},"${notes}"\n`;
                });
                
                // Add summary row
                csv += `\n"SUMMARY","","","",${filteredSessions.length} sessions,"","",${totalHours.toFixed(2)},"",${totalAmount.toFixed(2)},""\n`;
                
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `TimeReport_${start.toISOString().split('T')[0]}_to_${end.toISOString().split('T')[0]}.csv`;
                link.click();
            };

            return (
                <div>
                    <h2 style={{ color: 'var(--primary-start)', marginBottom: '20px' }}>Reports & Invoices</h2>

                    {!isBillingInfoComplete() && (
                        <div className="warning-message">
                            ‚ö†Ô∏è Please complete your billing information in Settings to generate invoices and reports.
                        </div>
                    )}

                    <div className="report-section">
                        <h3>Report Period</h3>
                        <div className="input-group">
                            <select 
                                value={reportPeriod} 
                                onChange={(e) => setReportPeriod(e.target.value)}
                                style={{ width: 'auto', minWidth: '200px' }}
                            >
                                <option value="daily">Today</option>
                                <option value="weekly">Last 7 Days</option>
                                <option value="biweekly">Last 14 Days</option>
                                <option value="custom">Custom Range</option>
                            </select>
                        </div>

                        {reportPeriod === 'custom' && (
                            <div className="form-row" style={{ marginTop: '15px' }}>
                                <div className="input-group">
                                    <label>Start Date</label>
                                    <input
                                        type="date"
                                        value={startDate}
                                        onChange={(e) => setStartDate(e.target.value)}
                                    />
                                </div>
                                <div className="input-group">
                                    <label>End Date</label>
                                    <input
                                        type="date"
                                        value={endDate}
                                        onChange={(e) => setEndDate(e.target.value)}
                                    />
                                </div>
                            </div>
                        )}
                    </div>

                    <div className="stats-grid">
                        <div className="stat-card">
                            <div className="stat-label">Work Sessions</div>
                            <div className="stat-value">{filteredSessions.length}</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-label">Total Hours</div>
                            <div className="stat-value">{totalHours.toFixed(2)}</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-label">Total Amount</div>
                            <div className="stat-value">${totalAmount.toFixed(2)}</div>
                        </div>
                    </div>

                    <div className="report-section">
                        <h3>Generate Reports</h3>
                        <div className="button-group">
                            <button 
                                onClick={generateExcelInvoice} 
                                className="btn-export"
                                disabled={!isBillingInfoComplete()}
                            >
                                Generate Excel Invoice
                            </button>
                            <button 
                                onClick={generateCSV} 
                                className="btn-export"
                                disabled={!isBillingInfoComplete()}
                            >
                                Generate CSV Report
                            </button>
                        </div>
                    </div>

                    <div className="report-section">
                        <h3>Period Details</h3>
                        <p style={{ color: '#6c757d' }}>
                            Report covers {start.toLocaleDateString()} through {end.toLocaleDateString()}
                        </p>
                        
                        {filteredSessions.length === 0 ? (
                            <p style={{ textAlign: 'center', color: '#6c757d', padding: '40px' }}>
                                No work sessions in this period
                            </p>
                        ) : (
                            <div style={{ marginTop: '20px' }}>
                                {filteredSessions.map((session, index) => (
                                    <div key={index} className="session-card">
                                        <div className="session-header">
                                            <div className="session-date">
                                                {new Date(session.startTime).toLocaleDateString()}
                                            </div>
                                            <div className="session-hours">
                                                {calculateHours(session).toFixed(2)} hrs = ${(calculateHours(session) * billingInfo.hourlyRate).toFixed(2)}
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        function SettingsTab({ exportData, importData, workSessions, setWorkSessions, billingInfo, setBillingInfo, setCurrentSession }) {
            const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);
            const [isEditingBilling, setIsEditingBilling] = useState(false);
            const [editedBilling, setEditedBilling] = useState(billingInfo);

            const handleBillingChange = (category, field, value) => {
                setEditedBilling(prev => ({
                    ...prev,
                    [category]: {
                        ...prev[category],
                        [field]: value
                    }
                }));
            };

            const handleRateChange = (value) => {
                setEditedBilling(prev => ({
                    ...prev,
                    hourlyRate: parseFloat(value) || 0
                }));
            };

            const saveBillingInfo = () => {
                setBillingInfo(editedBilling);
                setIsEditingBilling(false);
            };

            const cancelBillingEdit = () => {
                setEditedBilling(billingInfo);
                setIsEditingBilling(false);
            };

            const clearAllData = () => {
                if (showDeleteConfirm) {
                    setWorkSessions([]);
                    localStorage.removeItem('workSessions');
                    localStorage.removeItem('currentSession');
                    setCurrentSession(null);
                    
                    // Reset billing info to default
                    const defaultBilling = {
                        contractor: {
                            name: '',
                            address: '',
                            cityStateZip: '',
                            phone: '',
                            email: ''
                        },
                        client: {
                            companyName: '',
                            attn: '',
                            address: '',
                            cityStateZip: ''
                        },
                        hourlyRate: 0
                    };
                    setBillingInfo(defaultBilling);
                    setEditedBilling(defaultBilling);
                    localStorage.setItem('billingInfo', JSON.stringify(defaultBilling));
                    
                    setShowDeleteConfirm(false);
                    alert('All data has been cleared and reset to defaults!');
                }
            };

            return (
                <div>
                    <h2 style={{ color: 'var(--primary-start)', marginBottom: '20px' }}>Settings</h2>

                    <div className="settings-section">
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '15px' }}>
                            <h3 style={{ margin: 0 }}>Billing Information</h3>
                            {!isEditingBilling ? (
                                <button onClick={() => setIsEditingBilling(true)} className="btn-edit">
                                    Edit
                                </button>
                            ) : (
                                <div style={{ display: 'flex', gap: '10px' }}>
                                    <button onClick={saveBillingInfo} className="btn-add">
                                        Save
                                    </button>
                                    <button onClick={cancelBillingEdit} className="btn-import">
                                        Cancel
                                    </button>
                                </div>
                            )}
                        </div>

                        {!isEditingBilling ? (
                            <>
                                <h4 style={{ marginTop: '15px', marginBottom: '10px' }}>Contractor Information</h4>
                                <p><strong>Name:</strong> {billingInfo.contractor.name || '(Not set)'}</p>
                                <p><strong>Address:</strong> {billingInfo.contractor.address || '(Not set)'}</p>
                                <p><strong>City, State ZIP:</strong> {billingInfo.contractor.cityStateZip || '(Not set)'}</p>
                                <p><strong>Phone:</strong> {billingInfo.contractor.phone || '(Not set)'}</p>
                                <p><strong>Email:</strong> {billingInfo.contractor.email || '(Not set)'}</p>

                                <h4 style={{ marginTop: '15px', marginBottom: '10px' }}>Client Information</h4>
                                <p><strong>Company:</strong> {billingInfo.client.companyName || '(Not set)'}</p>
                                <p><strong>Attn:</strong> {billingInfo.client.attn || '(Not set)'}</p>
                                <p><strong>Address:</strong> {billingInfo.client.address || '(Not set)'}</p>
                                <p><strong>City, State ZIP:</strong> {billingInfo.client.cityStateZip || '(Not set)'}</p>

                                <h4 style={{ marginTop: '15px', marginBottom: '10px' }}>Rate</h4>
                                <p><strong>Hourly Rate:</strong> ${billingInfo.hourlyRate.toFixed(2)}</p>
                            </>
                        ) : (
                            <div>
                                <h4 style={{ marginTop: '15px', marginBottom: '10px' }}>Contractor Information</h4>
                                <div className="input-group">
                                    <label>Full Name</label>
                                    <input
                                        type="text"
                                        value={editedBilling.contractor.name}
                                        onChange={(e) => handleBillingChange('contractor', 'name', e.target.value)}
                                        placeholder="John Doe"
                                    />
                                </div>
                                <div className="input-group">
                                    <label>Address</label>
                                    <input
                                        type="text"
                                        value={editedBilling.contractor.address}
                                        onChange={(e) => handleBillingChange('contractor', 'address', e.target.value)}
                                        placeholder="123 Main Street"
                                    />
                                </div>
                                <div className="input-group">
                                    <label>City, State ZIP</label>
                                    <input
                                        type="text"
                                        value={editedBilling.contractor.cityStateZip}
                                        onChange={(e) => handleBillingChange('contractor', 'cityStateZip', e.target.value)}
                                        placeholder="Boston, MA 02101"
                                    />
                                </div>
                                <div className="input-group">
                                    <label>Phone</label>
                                    <input
                                        type="tel"
                                        value={editedBilling.contractor.phone}
                                        onChange={(e) => handleBillingChange('contractor', 'phone', e.target.value)}
                                        placeholder="(555) 123-4567"
                                    />
                                </div>
                                <div className="input-group">
                                    <label>Email</label>
                                    <input
                                        type="email"
                                        value={editedBilling.contractor.email}
                                        onChange={(e) => handleBillingChange('contractor', 'email', e.target.value)}
                                        placeholder="john@example.com"
                                    />
                                </div>

                                <h4 style={{ marginTop: '15px', marginBottom: '10px' }}>Client Information</h4>
                                <div className="input-group">
                                    <label>Company Name</label>
                                    <input
                                        type="text"
                                        value={editedBilling.client.companyName}
                                        onChange={(e) => handleBillingChange('client', 'companyName', e.target.value)}
                                        placeholder="Acme Corporation"
                                    />
                                </div>
                                <div className="input-group">
                                    <label>Attention To</label>
                                    <input
                                        type="text"
                                        value={editedBilling.client.attn}
                                        onChange={(e) => handleBillingChange('client', 'attn', e.target.value)}
                                        placeholder="Accounts Payable"
                                    />
                                </div>
                                <div className="input-group">
                                    <label>Address</label>
                                    <input
                                        type="text"
                                        value={editedBilling.client.address}
                                        onChange={(e) => handleBillingChange('client', 'address', e.target.value)}
                                        placeholder="456 Business Ave"
                                    />
                                </div>
                                <div className="input-group">
                                    <label>City, State ZIP</label>
                                    <input
                                        type="text"
                                        value={editedBilling.client.cityStateZip}
                                        onChange={(e) => handleBillingChange('client', 'cityStateZip', e.target.value)}
                                        placeholder="New York, NY 10001"
                                    />
                                </div>

                                <h4 style={{ marginTop: '15px', marginBottom: '10px' }}>Rate</h4>
                                <div className="input-group">
                                    <label>Hourly Rate ($)</label>
                                    <input
                                        type="number"
                                        step="0.01"
                                        min="0"
                                        value={editedBilling.hourlyRate}
                                        onChange={(e) => handleRateChange(e.target.value)}
                                        placeholder="75.00"
                                    />
                                </div>
                            </div>
                        )}
                    </div>

                    <div className="settings-section">
                        <h3>Data Management</h3>
                        <div className="button-group">
                            <button onClick={exportData} className="btn-export">
                                Export Backup (JSON)
                            </button>
                            <label style={{ 
                                padding: '15px 30px',
                                background: '#6c757d',
                                color: 'white',
                                borderRadius: '10px',
                                cursor: 'pointer',
                                display: 'inline-block'
                            }}>
                                Import Backup
                                <input 
                                    type="file" 
                                    accept=".json"
                                    onChange={importData}
                                    style={{ display: 'none' }}
                                />
                            </label>
                        </div>
                    </div>

                    <div className="settings-section">
                        <h3>Danger Zone</h3>
                        <p style={{ color: '#6c757d', marginBottom: '15px' }}>
                            This will delete all work sessions AND reset billing information to defaults.
                        </p>
                        {!showDeleteConfirm ? (
                            <button 
                                onClick={() => setShowDeleteConfirm(true)}
                                className="btn-end"
                            >
                                Clear All Data
                            </button>
                        ) : (
                            <div>
                                <p style={{ color: '#dc3545', marginBottom: '15px', fontWeight: 'bold' }}>
                                    ‚ö†Ô∏è Are you sure? This will delete all work sessions and reset billing info. This cannot be undone!
                                </p>
                                <div className="button-group">
                                    <button onClick={clearAllData} className="btn-end">
                                        Yes, Delete Everything
                                    </button>
                                    <button 
                                        onClick={() => setShowDeleteConfirm(false)}
                                        className="btn-import"
                                    >
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        )}
                    </div>

                    <div className="settings-section">
                        <h3>Statistics</h3>
                        <p>Total Work Sessions: {workSessions.length}</p>
                        <p>Data stored locally in your browser</p>
                    </div>

                    <div className="settings-section" style={{ textAlign: 'center', paddingTop: '30px', borderTop: '2px solid #dee2e6' }}>
                        <p style={{ fontSize: '0.9em', color: '#6c757d', marginBottom: '5px' }}>
                            <strong>Contractor Time Tracker</strong> v1.0.0
                        </p>
                        <p style={{ fontSize: '0.85em', color: '#6c757d', marginBottom: '5px' }}>
                            Developed by <strong>Joseph Mark Orimoloye</strong>
                        </p>
                        <p style={{ fontSize: '0.85em', color: '#6c757d', marginBottom: '10px' }}>
                            ¬© 2025 <strong>Cybonix Solutions LLC</strong>
                        </p>
                        <p style={{ fontSize: '0.8em', color: '#adb5bd' }}>
                            Licensed under MIT License
                        </p>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<TimeTracker />, document.getElementById('root'));
    </script>
</body>
</html>